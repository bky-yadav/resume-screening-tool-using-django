<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job Application Form</title>
<style>
    .container{
        display:flex;
        flex-direction:column;
        align-items:center;
        margin:10px;
    }
    .uploading{
        display:flex;
        width:100%;

    }

    #jb,#resume{
        display:flex;
        width:100%;
        flex-direction:column;
        align-items:center;
    }
    #resume{
       display:none;
    }
    .file-upload,.file-upload-text {
        display:flex;
        width:75%;
        border: 2px dashed #ccc;
        border-radius:10px;
        border-color:blue;
        padding: 20px;
        align-items:center;
        justify-content:center;
        height:200px;
        margin:50px;
        flex-direction:column;
    }
    .file-upload-text{
        display:none;
    }
    .file-upload-text textarea{
        width:100%;
        height:100%;
        border-color:white;
    }
    .file-upload-text textarea:focus{
        outline:none;
    }
    .file-upload button,.file-upload-text button{
        border:none;
        background-color:white;
        color:blue;
        cursor:pointer;
    }
    .file-upload input[type="file"] {
        display: none;
    }
    .file-upload label {
        display: block;
        cursor: pointer;
    }
    #job-description-label,#resume-content-label{
        color:blue;
        border:2px solid blue;
        border-radius:5px;
        padding:20px;
        text-align:center;
        margin:30px;
    }
    .button{
        height:30px;
        width:100px;
    }
    #previous-button{
        display:none;
    }
    #submit-button{
        margin:10px;
    }
    table {
        width: 40%;
        border-collapse: collapse;
        font-family: Arial, sans-serif;
        border: 1px solid #dddddd; 
    }

    th {
        background-color: #f2f2f2;
        text-align: left;
        padding: 8px;
        border: 1px solid #dddddd; 
    }
    td {
        padding: 8px;
        border: 1px solid #dddddd; 
    }
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    tr:hover {
        background-color: #f5f5f5;
    }
</style>
</head>
<body>
<div class="container">
    <button class="button" id='continue-button' onclick="go_to_resume()">continue</button>
    <button class="button" id='previous-button' onclick="go_to_jb()">previous</button>
        <div class="uploading">
            <div id="jb">
                <h2>Job Description</h2>
                <div class="file-upload">
                    <label for="job-description" id="job-description-label">Upload or Drop Job Description <p> as .pdf or .docx file </p></label>
                    <input type="file" id="job-description" accept=".pdf,.docx">
                    <button onClick="disable_file(this)"> copy paste</button>
                </div>
                <div class="file-upload-text">
                    <textarea id="job-description" placeholder="Type or paste resumes here"></textarea>
                    <button onClick="disable_text(this)">upload or drop</button>
                </div>
            </div>
            <div id="resume">
                <h2>Resume Upload</h2>
                <div class="file-upload">
                    <label for="resume-content" id="resume-content-label">Upload or Drop Resume Content <p> as .pdf or .docx file </p></label>
                    <input type="file" id="resume-content" accept=".pdf,.docx" multiple>
                    <button onClick="disable_file(this)"> copy paste</button>
                </div>
                <div class="file-upload-text">
                    <textarea id="resumes-content" placeholder="Type or paste resumes here"></textarea>
                    <button onClick="disable_text(this)">upload or drop</button>
                </div>
                <button class="button" onclick="uploadResume()">Add</button>
                <button class="button" id="submit-button">Submit</button>
                <table id="resume-list-div">
                    <tr><td>No File Selected</td></tr>
                </table>
            </div>
        </div>
</div>

<script>
    // Function to handle file uploads
    const dbName = "resume_list";
    const dbVersion = 2;
    const deleteRequest=indexedDB.deleteDatabase(dbName);
    deleteRequest.onsucess=(event)=>{
        console.log('Indexed Cleared');
      }
    deleteRequest.onerror=(event)=>{
        console.log('error:',event.target.error);
      }
    const request = indexedDB.open(dbName, dbVersion);
    request.onerror = (event) => {
      console.error("Error opening IndexedDB:", event.target.error);
    }
    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      const objectStore = db.createObjectStore("resumes", { autoIncrement: true, keyPath: "id" });
    };
    function disable_file(button){
        var file_=button.previousElementSibling;
        file_.value=''
        var div_=button.parentElement;
        div_.style.display='none';
        var div_next_sibling=div_.nextElementSibling;
        div_next_sibling.style.display='flex'
    }
    function disable_text(button){
        var textarea_=button.previousElementSibling;
        textarea_.value=''
        var div_=button.parentElement;
        div_.style.display='none';
        var div_next_sibling=div_.previousElementSibling;
        div_next_sibling.style.display='flex'
    }
    function go_to_resume(){
        var jb=document.getElementById('jb')
        var resume=document.getElementById('resume')
        var continue_button=document.getElementById('continue-button')
        var previous_button=document.getElementById('previous-button')
        jb.style.display='none'
        resume.style.display='flex'
        continue_button.style.display='none'
        previous_button.style.display='block'
    }
    function go_to_jb(){
        var jb=document.getElementById('jb')
        var resume=document.getElementById('resume')
        var continue_button=document.getElementById('continue-button')
        var previous_button=document.getElementById('previous-button')
        jb.style.display='flex'
        resume.style.display='none'
        continue_button.style.display='block'
        previous_button.style.display='none'
    }
    function uploadResume() {
        const fileInput = document.getElementById('resume-content')
        const selectedFiles = fileInput.files;
        if(selectedFiles.length==0){
          alert('Select some file')
        }
        else{
          const dbName = "resume_list";
          const request = indexedDB.open(dbName);
          request.onsuccess = async (event) => {
            const db = event.target.result;
            const fileReadPromises=[]
            for (let i = 0; i < selectedFiles.length; i++) {
              const file=selectedFiles[i]
              var v=0;
              const fileReadPromise=await new Promise((resolve,reject)=>{
                  v=i;
                  const reader= new FileReader()
                  reader.onload=(event)=>{
                    resolve({name: file.name,content:event.target.result})
                  }
                  reader.onerror=(event)=>{
                    reject(event.target.error)
                  }
                  reader.readAsText(file)
                })
              fileReadPromises.push(fileReadPromise)
            }
            try{
              const fileContents=await Promise.all(fileReadPromises)
              const transaction = db.transaction(["resumes"], "readwrite");
              const objectStore = transaction.objectStore("resumes");
              fileContents.forEach(fileData=>{
                objectStore.add(fileData)
              })
              transaction.oncomplete = () => {
                console.log("Files stored in IndexedDB successfully!");
                showUploadedResume();
                fileInput.value=''
              }
            }
            catch(error){
              console.log(error);
            }
          }
        }
      }
      function showUploadedResume() {
        const dbName = "resume_list";
        const request = indexedDB.open(dbName);
        request.onsuccess = (event) => {
            const db = event.target.result;
            const transaction = db.transaction(["resumes"], "readonly"); // Corrected mode
            const objectStore = transaction.objectStore("resumes");
            const request = objectStore.getAll();
          request.onsuccess = (event) => {
              const allItems = event.target.result;
              const list=document.getElementById('resume-list-div');
              list.innerHTML='<th>Selected Files</th>';
              for(let i=0;i<allItems.length;i++)
              {
                  const Text='<tr><td>'+allItems[i].name+'</td></tr>';
                  list.innerHTML=list.innerHTML+Text;
              }
          }
          request.onerror = (event) => {
            console.error('Error retrieving items:', event.target.error);
          }
        }
    }
</script>

</body>
</html>
